#+TITLE: ARLJohnston Emacs Configuration
#+Author: Alistair Johnston
#+Description: My Emacs configuration
#+PROPERTY: header-args :tangle ~/.emacs.d/init.el
#+auto_tangle: t
#+STARTUP: showeverything
#+OPTIONS: toc:2

* My Emacs Configuration

** Org Mode Configuration
Org mode allows for literate programming (like this document) and writing notes etc in a nice, structured way with multiple export options.
#+BEGIN_SRC emacs-lisp
	(straight-use-package 'org)
	(setq org-src-preserve-indentation t)

	(straight-use-package 'org-auto-tangle)
	(add-hook 'org-mode-hook 'org-auto-tangle-mode)
	(setq org-auto-tangle-default t)

  (straight-use-package 'org-roam)
  (setq org-roam-directory "~/org")

  (with-eval-after-load 'evil-leader
    (evil-leader/set-key "ni" 'org-roam-node-insert))

  (setq org-roam-capture-templates
    '(("d" "default" plain
      "%?"
      :if-new (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                         "#+title: ${title}\n")
      :unnarrowed t
      :jump-to-captured t)
    ("m" "meeting" plain
      "%?"
      :if-new (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                         "=================\n** Meeting %U\n:LOGBOOK:\n:END:\n Attendees:\n")
      :unnarrowed t
      :jump-to-captured t)))
#+END_SRC

** Unorganised
#+BEGIN_SRC emacs-lisp
  (setq ring-bell-function 'ignore)
  (setq-default tab-width 2)
  (setq-default flycheck-emacs-lisp-load-path 'inherit)
  (set-face-attribute 'default nil :font "MonoLisa Nerd Font")
  (tool-bar-mode -1)
  (scroll-bar-mode -1)
  (global-display-line-numbers-mode 1)
  (setq display-line-numbers-type 'relative)
  
  (require 'package)
  (add-to-list 'package-archives
    '("melpa" . "https://melpa.org/packages/"))
  (package-initialize)
  (package-refresh-contents)
  
  (load-theme 'zenburn t)
  
  (unless (package-installed-p 'editorconfig)
    (package-install 'editorconfig))
  
  (use-package copilot
    :straight (:host github :repo "zerolfx/copilot.el" :files ("dist" "*.el"))
    :ensure t)
  (add-hook 'prog-mode-hook 'copilot-mode)
  (define-key copilot-completion-map (kbd "<tab>") 'copilot-accept-completion)
  
  ;; Install magit 
  (straight-use-package 'magit)
  
  ;;lsp mode
  (use-package lsp-mode
  	:straight t)
  (add-to-list 'lsp-language-id-configuration '(nix-mode . "nix"))
  (lsp-register-client
    (make-lsp-client :new-connection (lsp-stdio-connection '("rnix-lsp"))
                    :major-modes '(nix-mode)
                    :server-id 'nix))
  
  (straight-use-package 'nix-mode
    :mode "\\.nix\\'")
  
  ;; haskell mode
  (straight-use-package 'haskell-mode
  	:config
  	(add-hook 'haskell-mode-hook 'interactive-haskell-mode))
  
  (add-to-list 'load-path "~/.emacs.d/lsp/")
#+END_SRC

** Evil Mode Configuration
#+BEGIN_SRC emacs-lisp
(evil-mode 1)
(use-package evil
	:straight t
	:ensure t)

(use-package undo-tree
	:straight t
	:ensure t)
(global-undo-tree-mode)

(setq evil-undo-system 'undo-tree)


(add-to-list 'load-path "~/.emacs.d/evil/")
(straight-use-package 'evil-leader)
(global-evil-leader-mode)
(evil-leader-mode 1)
(evil-leader/set-leader "<SPC>")
(evil-leader/set-key "." 'fzf-find-file)
(evil-leader/set-key "bi" 'fzf-switch-buffer)
(evil-leader/set-key "bk" 'kill-this-buffer)
(evil-leader/set-key "bm" 'buffer-menu)
#+END_SRC


** FZF Configuration
#+BEGIN_SRC emacs-lisp
(straight-use-package 'fzf
  :bind
  ;; Don't forget to set keybinds!
  :config
  (setq fzf/args "-x --tabstop 2 --color dark --print-query --margin=1,0 --no-hscroll"
      fzf/executable "fzf"
      fzf/git-grep-args "-i --line-number %s"
      ;; command used for `fzf-grep-*` functions
      ;; example usage for ripgrep:
      ;; fzf/grep-command "rg --no-heading -nH"
      fzf/grep-command "grep -nrH"
      ;; If nil, the fzf buffer will appear at the top of the window
      fzf/position-bottom t
      fzf/window-height 15))
#+END_SRC

** Company
Globally offer auto completion functionality.
#+BEGIN_SRC emacs-lisp
(straight-use-package 'company
	:config
	(setq company-idle-delay 0)
	(setq company-minimum-prefix-length 1)
	(global-company-mode t))
#+END_SRC
